---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: traefik-dashboard-tls
spec:
  secretName: traefik-dashboard-tls
  privateKey:
    algorithm: ECDSA
    size: 256
    rotationPolicy: Always
  dnsNames:
    - traefik-lb.xmple.io
  issuerRef:
    name: letsencrypt-production
    kind: ClusterIssuer
---
apiVersion: traefik.io/v1alpha1
kind: TLSOption
metadata:
  name: mintls13
spec:
  minVersion: VersionTLS13
  curvePreferences:
    - CurveP384
---
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: traefik
spec:
  gatewayClassName: traefik:gat
  # Only Routes from the same namespace are allowed.
  listeners:
    - name: http
      protocol: HTTP
      port: 8000         # Traefik HTTP default port, adjust as needed
      allowedRoutes:
        namespaces:
          from: All | Same    # All => Allow all routes unconditionally
                              # Same => Allow routes in the same namespace
    - name: https
      protocol: HTTPS
      port: 8443         # Traefik HTTPS default port, adjust as needed
      tls:
        mode: Terminate
        certificateRefs:
          - name: traefik-dashboard-tls
            namespace: default
      allowedRoutes:
        namespaces:
          from: All | Same   # All => Allow all routes unconditionally
                             # Same => Allow routes in the same namespace